<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-how-tos/openvpn/integration-linux" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.0">
<title data-rh="true">OpenVPN Integration Guide for Linux | emnify Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.emnify.com/pr-preview/pr-238/how-tos/openvpn-integration-linux"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="OpenVPN Integration Guide for Linux | emnify Documentation"><meta data-rh="true" name="description" content="Integration Guide for OpenVPN on Linux"><meta data-rh="true" property="og:description" content="Integration Guide for OpenVPN on Linux"><link data-rh="true" rel="icon" href="/pr-preview/pr-238/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.emnify.com/pr-preview/pr-238/how-tos/openvpn-integration-linux"><link data-rh="true" rel="alternate" href="https://docs.emnify.com/pr-preview/pr-238/how-tos/openvpn-integration-linux" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.emnify.com/pr-preview/pr-238/how-tos/openvpn-integration-linux" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://WXU9AQM67J-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="emnify Documentation" href="/pr-preview/pr-238/opensearch.xml">


<script src="https://cdn.cookielaw.org/consent/0c5a33bc-8e12-407d-937d-4e4c9f6e86a0/OtAutoBlock.js" defer="defer"></script>
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language charset="UTF-8" data-domain-script="0c5a33bc-8e12-407d-937d-4e4c9f6e86a0" defer="defer"></script>
<script src="/scripts/optanonWrapper.js" defer="defer"></script>
<script src="/scripts/googleTagManager.js" async></script>
<script src="/scripts/jentisTagManager.js"></script>
<script src="/scripts/heapAnalytics.js"></script><link rel="stylesheet" href="/pr-preview/pr-238/assets/css/styles.a08c3a71.css">
<script src="/pr-preview/pr-238/assets/js/runtime~main.a084a306.js" defer="defer"></script>
<script src="/pr-preview/pr-238/assets/js/main.74276b08.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/pr-preview/pr-238/"><div class="navbar__logo"><img src="/pr-preview/pr-238/img/logo-word-blue-295x80.png" alt="emnify Documentation – Home" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/pr-preview/pr-238/img/logo-word-blue-295x80.png" alt="emnify Documentation – Home" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Documentation</b></a></div><div class="navbar__items navbar__items--right"><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><main class="docMainContainer_TBSr docMainContainerEnhanced_lQrH"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>OpenVPN Integration Guide for Linux</h1>
<p>emnify customers can create their own Virtual Private Network for their mobile IoT/M2M devices fitted with emnify SIMs.
Data traffic will be exchanged between the devices and the application server through an OpenVPN tunnel, enabling direct communication with the IPs of the mobile devices (no NAT applied).</p>
<p>The tunnel is established between the emnify Core Network and the customers VPN gateway or server.</p>
<p>See this video <a href="https://www.youtube.com/watch?v=yt44fJpfkQ4" target="_blank" rel="noopener noreferrer">guide for how to secure your devices with Open VPN</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="add-mandatory-layer-of-security-and-privacy">Add mandatory layer of security and privacy<a href="#add-mandatory-layer-of-security-and-privacy" class="hash-link" aria-label="Direct link to Add mandatory layer of security and privacy" title="Direct link to Add mandatory layer of security and privacy">​</a></h2>
<p>Any traffic exchanged with the mobile devices is encrypted before transmitted over the public internet, therefore adding an additional layer of security and privacy.
For that <strong>no</strong> VPN software needs to be installed on the device or any configuration changes to be done, the default emnify APN does also support VPN flows.</p>
<p>First, download the VPN config file from the emnify User Interface</p>
<ol>
<li>Click on the &quot;Integrations&quot; menu</li>
<li>Scroll down to the &quot;secure connection&quot; section and download the configuration file</li>
</ol>
<p>Additionally, you need to change the Internet Regional Breakout in the device policy:</p>
<ol>
<li>Click on &quot;Device Policies&quot;</li>
<li>Scroll down to &quot;Service Policies&quot;, select the policy assigned to the devices you want to secure and click on &quot;Details&quot;.</li>
<li>On the &quot;Internet Breakout Region&quot; menu, set the Service Policy to a VPN breakout region, e.g., <code>eu-west-1 (VPN)</code></li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="setting-up-openvpn-client-on-linuxubuntu">Setting Up OpenVPN Client on Linux/Ubuntu<a href="#setting-up-openvpn-client-on-linuxubuntu" class="hash-link" aria-label="Direct link to Setting Up OpenVPN Client on Linux/Ubuntu" title="Direct link to Setting Up OpenVPN Client on Linux/Ubuntu">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="install-openvpn-software">Install OpenVPN Software<a href="#install-openvpn-software" class="hash-link" aria-label="Direct link to Install OpenVPN Software" title="Direct link to Install OpenVPN Software">​</a></h3>
<p>Install openvpn package</p>
<p><code>sudo apt-get install openvpn</code></p>
<p>Log in with your user account on the emnify Portal and select the &quot;Link&quot; Icon on the top/right.
From there you can download a pre-configured configuration file, the filename is <strong>client.conf</strong></p>
<p>Download and Install VPN Configuration File</p>
<p>Please store that file on your server in the folder /etc/openvpn.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-credentials-for-authentication">Create Credentials for Authentication<a href="#create-credentials-for-authentication" class="hash-link" aria-label="Direct link to Create Credentials for Authentication" title="Direct link to Create Credentials for Authentication">​</a></h3>
<p>In the next steps you need to create a file called <strong>credentials.txt</strong> in the folder /etc/openvpn. You can choose to use your user credentials to authenticate or to use an application token (recommended).</p>
<ul>
<li>Authentication with User Credentials
The content of the credentials.txt must be just two lines, first line your username and second your password.</li>
</ul>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">username@domain.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">YourPassword</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>Authentication with Application Token
If you do not want to store your credentials you can also choose to enter them each time the VPN tunnel is established, if you prefer that option please comment out the line &quot;auth-user-pass /etc/openvpn/credentials.txt&quot; in the client.conf file.</li>
</ul>
<p>When you run the OpenVPN client on a VPN gateway or application server it is recommended to use a dedicated application token.
In this case the first line in the credentials.txt file needs to be filled with your emnify organisation identifier and instead of the password you store the application token.</p>
<p>You can create application tokens when you log in to the emnify Portal, select the &quot;Link&quot; Icon on the top/right and then &quot;Create New Application Token&quot;.
Please Copy+Paste the token into the credentials file.</p>
<p>The content of the credentials file would then look like this</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">orgId</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ApplicationToken</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>When you log in to the emnify Portal it will shows this data under the VPN settings.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="protecting-the-credentials-file">Protecting the Credentials File<a href="#protecting-the-credentials-file" class="hash-link" aria-label="Direct link to Protecting the Credentials File" title="Direct link to Protecting the Credentials File">​</a></h3>
<p>You should keep the credentials.txt file only readable by root and not by other users of your server.
You can ensure this with the following commands:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">sudo chown root:root /etc/openvpn/credentials.txt</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">sudo chmod 600 /etc/openvpn/credentials.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="starting-and-monitoring-the-openvpn-connection">Starting and Monitoring the OpenVPN connection<a href="#starting-and-monitoring-the-openvpn-connection" class="hash-link" aria-label="Direct link to Starting and Monitoring the OpenVPN connection" title="Direct link to Starting and Monitoring the OpenVPN connection">​</a></h3>
<p>Now you can start the VPN client by running</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">sudo service openvpn start</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The openvpn daemon will log into /var/log/syslog, if everything works it would like this:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">Jul 12 17:53:55 openvpn-client ovpn-client[3027]: Data Channel Encrypt: Cipher &#x27;BF-CBC&#x27; initialized with 128 bit key</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Jul 12 17:53:55 openvpn-client ovpn-client[3027]: Data Channel Encrypt: Using 160 bit message hash &#x27;SHA1&#x27; for HMAC authentication</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Jul 12 17:53:55 openvpn-client ovpn-client[3027]: Control Channel: TLSv1, cipher TLSv1/SSLv3 DHE-RSA-AES256-SHA, 2048 bit RSA</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Jul 12 17:53:55 openvpn-client ovpn-client[3027]: [openvpn.emnify.net] Peer Connection Initiated with [AF_INET]52.209.x.y:1194</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Jul 12 17:53:57 openvpn-client ovpn-client[3027]: SENT CONTROL [openvpn.emnify.net]: &#x27;PUSH_REQUEST&#x27; (status=1)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Jul 12 17:53:57 openvpn-client ovpn-client[3027]: PUSH: Received control message: &#x27;PUSH_REPLY,route 10.64.0.1,topology net30,ping 1,ping-restart 5,route 10.x.y.z 255.255.128.0,ifconfig 10.64.0.224 10.64.0.225&#x27;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Jul 12 17:53:57 openvpn-client ovpn-client[3027]: TUN/TAP device tun0 opened</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Jul 12 17:53:57 openvpn-client ovpn-client[3027]: /sbin/route add -net 10.64.0.1 netmask 255.255.255.255 gw 10.64.0.225</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Jul 12 17:53:57 openvpn-client ovpn-client[3027]: /sbin/route add -net 10.x.y.z netmask 255.255.128.0 gw 10.64.0.225</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="finding-the-static-private-ip-of-your-vpn-client">Finding the static private IP of your VPN client<a href="#finding-the-static-private-ip-of-your-vpn-client" class="hash-link" aria-label="Direct link to Finding the static private IP of your VPN client" title="Direct link to Finding the static private IP of your VPN client">​</a></h3>
<p>The emnify OpenVPN server will allocate a static IP address to the tun interface of your VPN client, this IP will also stay the same when your VPN client is reconnecting or if you move the tunnel to a different machine.
So you can use it on your mobile devices to address your application, nevertheless you should never configure the IP directly on your devices, but use a DNS to resolve it.</p>
<p>Once the tunnel is establish you can see that IP address on your tun interface:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">ubuntu@openvpn-client:~$ ip a s tun0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">14: tun0: &lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UNKNOWN qlen 100</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    link/none </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    inet 10.64.0.224 peer 10.64.0.225/32 scope global tun0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In this sample the IP address is 10.64.0.224</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="testing-successfull-data-connectivity">Testing Successfull Data Connectivity<a href="#testing-successfull-data-connectivity" class="hash-link" aria-label="Direct link to Testing Successfull Data Connectivity" title="Direct link to Testing Successfull Data Connectivity">​</a></h3>
<p>If the VPN tunnel is established successfully you will be able to connect directly to the private IP addresses of your mobile devices.</p>
<p>For testing you can choose any for your endpoints that as currently an active data session, for log in to the emnify Portal and select on of your endpoints, in the details you will if it is currently online or not and you will see the IP address it has assigned.</p>
<p>Now will be able to ping that private IP address:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">root@openvpn-client:~# ping 10.x.y.z</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">PING 10.x.y.z (10.x.y.z) 56(84) bytes of data.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">64 bytes from 10.x.y.z: icmp_req=1 ttl=62 time=72 ms</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">64 bytes from 10.x.y.z: icmp_req=2 ttl=62 time=80 ms</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">64 bytes from 10.x.y.z: icmp_req=3 ttl=62 time=75 ms</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>For this to work your device needs to run an IP stack that is responding to ICMP echo request, this might not be the case for embedded devices that do implement only partial IP stack functionality.</p>
<p>You will be able to use any network protocolls, e.g. if your device is running a sshd daemon you would now be able to log into it via ssh.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="enabling-access-for-servers-behind-the-vpn-client">Enabling Access for Servers behind the VPN client<a href="#enabling-access-for-servers-behind-the-vpn-client" class="hash-link" aria-label="Direct link to Enabling Access for Servers behind the VPN client" title="Direct link to Enabling Access for Servers behind the VPN client">​</a></h3>
<p>If you have multiple servers behind your VPN gateway that need to communicate with your mobile device, you can apply masquerading using iptables to hide them behind the single IP address of your VPN client.</p>
<p>First you need to enable IP forwarding on your VPN gateway (if not already active) by editing your /etc/sysctl.conf and set net.ipv4.ip_forward=1, after that load the config with sudo sysctl -p /etc/sysctl.conf</p>
<p>After that you need to enable masquerading for the tun interface by running</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">sudo iptables -t nat -A POSTROUTING -o tun0 -j MASQUERADE</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You can also forward connections coming to specific ports to an application server behind your VPN gateway by using DNAT, e.g. to forward to an internal HTTP server at IP 192.168.100.21 use:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">sudo iptables -t nat -A PREROUTING -i tun0 -p tcp --dport 80 -j DNAT --to-destination 192.168.100.21</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If you want to make these settings persistent you can use the iptables-persistent package.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/emnify/product-docs/blob/main/docs/how-tos/openvpn/integration-linux.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2024-01-11T00:00:00.000Z">Jan 11, 2024</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#add-mandatory-layer-of-security-and-privacy" class="table-of-contents__link toc-highlight">Add mandatory layer of security and privacy</a></li><li><a href="#setting-up-openvpn-client-on-linuxubuntu" class="table-of-contents__link toc-highlight">Setting Up OpenVPN Client on Linux/Ubuntu</a><ul><li><a href="#install-openvpn-software" class="table-of-contents__link toc-highlight">Install OpenVPN Software</a></li><li><a href="#create-credentials-for-authentication" class="table-of-contents__link toc-highlight">Create Credentials for Authentication</a></li><li><a href="#protecting-the-credentials-file" class="table-of-contents__link toc-highlight">Protecting the Credentials File</a></li><li><a href="#starting-and-monitoring-the-openvpn-connection" class="table-of-contents__link toc-highlight">Starting and Monitoring the OpenVPN connection</a></li><li><a href="#finding-the-static-private-ip-of-your-vpn-client" class="table-of-contents__link toc-highlight">Finding the static private IP of your VPN client</a></li><li><a href="#testing-successfull-data-connectivity" class="table-of-contents__link toc-highlight">Testing Successfull Data Connectivity</a></li><li><a href="#enabling-access-for-servers-behind-the-vpn-client" class="table-of-contents__link toc-highlight">Enabling Access for Servers behind the VPN client</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Resources</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.emnify.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">emnify website<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.emnify.com/developer-blog" target="_blank" rel="noopener noreferrer" class="footer__link-item">Developer blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Support</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://support.emnify.com/hc/en-us" target="_blank" rel="noopener noreferrer" class="footer__link-item">Open a ticket<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://emnify.canny.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Request a feature<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/emnify/" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/emnify" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.emnify.com/imprint-disclaimer" target="_blank" rel="noopener noreferrer" class="footer__link-item">Imprint<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.emnify.com/privacy-policy" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy policy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item">
                <button style="visibility:hidden;" id="ot-sdk-btn" class="ot-sdk-show-settings">
                  Cookie Settings
                </button>
              </li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/pr-preview/pr-238/img/logo-icon-only-dark.svg" alt="" class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE" style="margin-top:0.5rem"><img src="/pr-preview/pr-238/img/logo-icon-only-dark.svg" alt="" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU" style="margin-top:0.5rem"></div><div class="footer__copyright">Copyright © 2024 emnify GmbH. All rights reserved.</div></div></div></footer></div>
</body>
</html>